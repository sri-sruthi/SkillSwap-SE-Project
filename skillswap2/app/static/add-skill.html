<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Add Skill</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
body { background:#f4f6fb }
.card { border-radius:15px; box-shadow:0 4px 15px rgba(0,0,0,.1) }
</style>
</head>

<body>

<div class="container mt-5 col-md-6">
<div class="card p-4">

<h3>ðŸŽ¯ Add Skill</h3>

<span id="roleBadge" class="badge bg-primary mb-3"></span>

<form id="skillForm">

<input id="skillName" class="form-control mb-2" placeholder="Skill name" required>

<textarea id="description" class="form-control mb-2" placeholder="Description"></textarea>

<select id="category" class="form-control mb-2">
<option>Programming</option>
<option>Design</option>
<option>Other</option>
</select>

<select id="level" class="form-control mb-3">
<option value="beginner">Beginner</option>
<option value="intermediate">Intermediate</option>
<option value="advanced">Advanced</option>
</select>

<button class="btn btn-primary w-100">Save Skill</button>

</form>

<hr>

<h5>ðŸ“š My Skills</h5>
<div id="mySkills"></div>

</div>
</div>

<script>

const token = localStorage.getItem("token")
const role = localStorage.getItem("role")

document.getElementById("roleBadge").innerText = "Role: " + role

document.getElementById("skillForm").addEventListener("submit", async e => {
    e.preventDefault()

    const skillName = document.getElementById("skillName").value
    const description = document.getElementById("description").value
    const category = document.getElementById("category").value
    const level = document.getElementById("level").value

    // STEP 1 â€” create/get skill
    const skillRes = await fetch("http://localhost:8000/skills/", {
        method: "POST",
        headers: {
            "Authorization": "Bearer " + token,
            "Content-Type": "application/json"
        },
        body: JSON.stringify({
            name: skillName,
            description: description,
            category: category
        })
    })

    const skill = await skillRes.json()

    // STEP 2 â€” link skill to user (teach or learn)
    const endpoint = role === "mentor"
        ? "http://localhost:8000/skills/teach"
        : "http://localhost:8000/skills/learn"

    await fetch(endpoint, {
        method: "POST",
        headers: {
            "Authorization": "Bearer " + token,
            "Content-Type": "application/json"
        },
        body: JSON.stringify({
            skill_id: skill.id,
            proficiency_level: level
        })
    })

    alert("Skill saved successfully!")
    loadMySkills()
})


async function loadMySkills(){

    const endpoint = role === "mentor"
      ? "http://localhost:8000/skills/my/teach"
      : "http://localhost:8000/skills/my/learn"

    const res = await fetch(endpoint,{
        headers:{ "Authorization":"Bearer "+token }
    })

    const skills = await res.json()

    let html = ""

    skills.forEach(s=>{
        html += `
        <div class="border rounded p-2 mt-2">
            <strong>${s.skill.name}</strong> â€” ${s.proficiency_level}
        </div>`
    })

    document.getElementById("mySkills").innerHTML = html
}

loadMySkills()

</script>
</body>
</html>
