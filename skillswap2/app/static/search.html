<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Discover Skills - SkillSwap</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
body {
  background: linear-gradient(135deg, #667eea, #764ba2);
  min-height: 100vh;
  margin: 0;
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
}

/* TOP NAVBAR */
.top-navbar {
  background: white;
  padding: 15px 30px;
  box-shadow: 0 2px 15px rgba(0,0,0,0.1);
  display: flex;
  justify-content: space-between;
  align-items: center;
  position: sticky;
  top: 0;
  z-index: 100;
}
.navbar-brand {
  font-size: 1.5rem;
  font-weight: 800;
  background: linear-gradient(135deg, #667eea, #764ba2);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}
.profile-trigger {
  display: flex;
  align-items: center;
  gap: 12px;
  background: linear-gradient(135deg, #667eea, #764ba2);
  color: white;
  padding: 10px 20px;
  border-radius: 25px;
  cursor: pointer;
  transition: all 0.3s;
  border: none;
  font-weight: 600;
}
.profile-trigger:hover {
  transform: translateY(-2px);
  box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
}
.profile-avatar-small {
  width: 35px;
  height: 35px;
  border-radius: 50%;
  background: white;
  color: #667eea;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.2rem;
}

/* SLIDING PROFILE SIDEBAR (RIGHT) */
.profile-sidebar {
  position: fixed;
  right: -350px;
  top: 0;
  width: 350px;
  height: 100vh;
  background: white;
  box-shadow: -5px 0 25px rgba(0,0,0,0.2);
  transition: right 0.3s ease-in-out;
  z-index: 1000;
  overflow-y: auto;
}
.profile-sidebar.open {
  right: 0;
}
.profile-sidebar-header {
  background: linear-gradient(135deg, #667eea, #764ba2);
  padding: 30px 20px;
  color: white;
  position: relative;
}
.close-sidebar {
  position: absolute;
  top: 15px;
  right: 15px;
  background: rgba(255,255,255,0.2);
  border: none;
  color: white;
  font-size: 1.5rem;
  width: 35px;
  height: 35px;
  border-radius: 50%;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.2s;
}
.close-sidebar:hover {
  background: rgba(255,255,255,0.3);
  transform: rotate(90deg);
}
.profile-avatar-large {
  width: 80px;
  height: 80px;
  border-radius: 50%;
  background: white;
  color: #667eea;
  display: flex;
  align-items: center;
  justify-content: center;
  margin: 0 auto 15px;
  font-size: 2.5rem;
  box-shadow: 0 4px 15px rgba(0,0,0,0.2);
}
.profile-name {
  font-size: 1.3rem;
  font-weight: 700;
  text-align: center;
  margin-bottom: 8px;
}
.profile-role {
  text-align: center;
  background: rgba(255,255,255,0.2);
  padding: 6px 16px;
  border-radius: 20px;
  font-size: 0.9rem;
  display: inline-block;
  width: 100%;
}
.profile-content {
  padding: 25px 20px;
}
.profile-section {
  margin-bottom: 25px;
}
.section-title {
  font-size: 0.85rem;
  font-weight: 700;
  color: #6b7280;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  margin-bottom: 12px;
}
.profile-info-item {
  background: #f9fafb;
  padding: 12px 15px;
  border-radius: 10px;
  margin-bottom: 10px;
  border-left: 3px solid #667eea;
}
.info-label {
  font-size: 0.75rem;
  color: #6b7280;
  font-weight: 600;
  margin-bottom: 4px;
}
.info-value {
  font-size: 0.95rem;
  color: #1f2937;
  font-weight: 600;
}
.profile-btn {
  width: 100%;
  padding: 12px;
  border: none;
  border-radius: 10px;
  font-weight: 700;
  cursor: pointer;
  transition: all 0.3s;
  margin-bottom: 10px;
  font-size: 0.95rem;
}
.btn-primary-custom {
  background: linear-gradient(135deg, #667eea, #764ba2);
  color: white;
}
.btn-primary-custom:hover {
  transform: translateY(-2px);
  box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
}
.btn-outline-custom {
  background: white;
  color: #667eea;
  border: 2px solid #667eea;
}
.btn-outline-custom:hover {
  background: #f3f4f6;
}
.btn-danger-custom {
  background: #ef4444;
  color: white;
}

/* OVERLAY */
.sidebar-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.5);
  z-index: 999;
  display: none;
}
.sidebar-overlay.show {
  display: block;
}

/* MAIN CONTENT */
.main-content {
  padding: 30px 20px;
  max-width: 1400px;
  margin: 0 auto;
}
.page-header {
  text-align: center;
  margin-bottom: 40px;
}
.page-header h1 {
  color: white;
  font-size: 2.8rem;
  font-weight: 900;
  margin-bottom: 15px;
  text-shadow: 0 2px 10px rgba(0,0,0,0.2);
}
.page-header p {
  color: rgba(255,255,255,0.95);
  font-size: 1.2rem;
}
.search-card {
  background: white;
  border-radius: 20px;
  padding: 35px;
  box-shadow: 0 10px 40px rgba(0,0,0,0.2);
  margin-bottom: 30px;
}
.search-input-wrapper {
  position: relative;
  margin-bottom: 30px;
}
.search-input {
  width: 100%;
  padding: 18px 60px 18px 25px;
  border: 3px solid #e5e7eb;
  border-radius: 15px;
  font-size: 1.1rem;
  transition: all 0.3s;
}
.search-input:focus {
  outline: none;
  border-color: #667eea;
  box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
}
.search-btn {
  position: absolute;
  right: 8px;
  top: 8px;
  padding: 10px 25px;
  background: linear-gradient(135deg, #667eea, #764ba2);
  color: white;
  border: none;
  border-radius: 10px;
  font-weight: 600;
  cursor: pointer;
}
.popular-section {
  margin-bottom: 30px;
}
.popular-tags {
  display: flex;
  gap: 10px;
  flex-wrap: wrap;
}
.popular-tag {
  background: #dbeafe;
  color: #1e40af;
  padding: 8px 16px;
  border-radius: 20px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s;
}
.popular-tag:hover {
  background: #bfdbfe;
  transform: translateY(-2px);
}
.categories-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
  gap: 20px;
  margin-bottom: 30px;
}
.category-card {
  background: white;
  border-radius: 15px;
  padding: 20px;
  text-align: center;
  transition: all 0.3s;
  box-shadow: 0 4px 12px rgba(0,0,0,0.08);
  cursor: pointer;
}
.category-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 8px 20px rgba(102, 126, 234, 0.2);
}
.category-icon {
  font-size: 2rem;
  margin-bottom: 10px;
}
.tabs-nav {
  display: flex;
  gap: 10px;
  margin-bottom: 30px;
  flex-wrap: wrap;
  padding-bottom: 20px;
  border-bottom: 3px solid #e5e7eb;
}
.tab-btn {
  padding: 12px 28px;
  border: none;
  background: #f3f4f6;
  border-radius: 12px;
  cursor: pointer;
  transition: all 0.3s;
  font-weight: 600;
  font-size: 1rem;
  color: #4b5563;
}
.tab-btn.active {
  background: linear-gradient(135deg, #667eea, #764ba2);
  color: white;
  box-shadow: 0 5px 20px rgba(102, 12, 234, 0.3);
}
.skills-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
  gap: 25px;
}
.skill-card {
  background: white;
  border-left: 5px solid #667eea;
  border-radius: 15px;
  padding: 25px;
  transition: all 0.3s;
  cursor: pointer;
  box-shadow: 0 4px 15px rgba(0,0,0,0.08);
}
.skill-card:hover {
  transform: translateY(-8px) scale(1.02);
  box-shadow: 0 12px 30px rgba(102, 126, 234, 0.2);
}
.skill-title {
  font-size: 1.4rem;
  font-weight: bold;
  color: #1f2937;
  margin-bottom: 10px;
}
.mentor-count {
  background: linear-gradient(135deg, #10b981, #059669);
  color: white;
  padding: 6px 14px;
  border-radius: 20px;
  font-size: 0.85rem;
  font-weight: 700;
  display: inline-block;
}
.view-mentors-btn {
  padding: 10px 22px;
  background: linear-gradient(135deg, #667eea, #764ba2);
  color: white;
  border: none;
  border-radius: 10px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s;
  margin-top: 15px;
}

/* Modal */
.modal-overlay {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.7);
  z-index: 9999;
  align-items: center;
  justify-content: center;
}
.modal-overlay.show {
  display: flex;
}
.modal-content {
  background: white;
  border-radius: 20px;
  padding: 40px;
  max-width: 600px;
  width: 90%;
  max-height: 90vh;
  overflow-y: auto;
}
.modal-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 25px;
  padding-bottom: 20px;
  border-bottom: 2px solid #e5e7eb;
}
.close-btn {
  background: none;
  border: none;
  font-size: 2rem;
  cursor: pointer;
  color: #6b7280;
}
.form-group {
  margin-bottom: 20px;
}
.form-label {
  font-weight: 700;
  color: #374151;
  margin-bottom: 8px;
  display: block;
}
.form-control {
  width: 100%;
  padding: 12px 15px;
  border: 2px solid #e5e7eb;
  border-radius: 10px;
  font-size: 1rem;
}
.form-control:focus {
  outline: none;
  border-color: #667eea;
  box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
}
</style>
</head>
<body>
<!-- Top Navbar -->
<div class="top-navbar">
  <div class="navbar-brand">üéì SkillSwap</div>
  <button class="profile-trigger" onclick="toggleProfileSidebar()">
    <div class="profile-avatar-small" id="navAvatar">üë§</div>
    <span id="navName">User</span>
  </button>
</div>

<!-- Sidebar Overlay -->
<div class="sidebar-overlay" id="sidebarOverlay" onclick="closeProfileSidebar()"></div>

<!-- Sliding Profile Sidebar (RIGHT) -->
<div class="profile-sidebar" id="profileSidebar">
  <div class="profile-sidebar-header">
    <button class="close-sidebar" onclick="closeProfileSidebar()">√ó</button>
    <div class="profile-avatar-large" id="profileAvatar">üë§</div>
    <div class="profile-name" id="profileName">Loading...</div>
    <div class="profile-role" id="profileRole">User</div>
  </div>
  <div class="profile-content">
    <!-- MENTOR PROFILE -->
    <div id="mentorProfile" style="display:none;">
      <div class="profile-section">
        <div class="section-title">üìä Profile Information</div>
        <div class="profile-info-item">
          <div class="info-label">Email</div>
          <div class="info-value" id="mentorEmail">-</div>
        </div>
        <div class="profile-info-item">
          <div class="info-label">Qualification</div>
          <div class="info-value" id="mentorQualification">-</div>
        </div>
        <div class="profile-info-item">
          <div class="info-label">Experience</div>
          <div class="info-value" id="mentorExperience">-</div>
        </div>
        <div class="profile-info-item">
          <div class="info-label">Age</div>
          <div class="info-value" id="mentorAge">-</div>
        </div>
      </div>
      <div class="profile-section">
        <div class="section-title">‚öôÔ∏è Quick Actions</div>
        <button onclick="window.location.href='/static/add-skill.html'" class="profile-btn btn-primary-custom">
          ‚ûï Add Skill
        </button>
        <button onclick="window.location.href='/static/sessions.html'" class="profile-btn btn-outline-custom">
          üìÖ My Sessions
        </button>
        <button onclick="showEditProfile()" class="profile-btn btn-outline-custom">
          ‚úèÔ∏è Edit Profile
        </button>
        <button onclick="showChangePassword()" class="profile-btn btn-outline-custom">
          üîí Change Password
        </button>
      </div>
      <div class="profile-section">
        <button onclick="logout()" class="profile-btn btn-danger-custom">
          üö™ Logout
        </button>
      </div>
    </div>

    <!-- LEARNER PROFILE -->
    <div id="learnerProfile" style="display:none;">
      <div class="profile-section">
        <div class="section-title">üìä Profile Information</div>
        <div class="profile-info-item">
          <div class="info-label">Full Name</div>
          <div class="info-value" id="learnerFullName">-</div>
        </div>
        <div class="profile-info-item">
          <div class="info-label">Email</div>
          <div class="info-value" id="learnerEmail">-</div>
        </div>
        <div class="profile-info-item">
          <div class="info-label">Institution</div>
          <div class="info-value" id="learnerInstitution">-</div>
        </div>
        <div class="profile-info-item">
          <div class="info-label">Age</div>
          <div class="info-value" id="learnerAge">-</div>
        </div>
      </div>
      <div class="profile-section">
        <div class="section-title">‚öôÔ∏è Quick Actions</div>
        <button onclick="window.location.href='/static/sessions.html'" class="profile-btn btn-primary-custom">
          üìÖ My Sessions
        </button>
        <button onclick="showEditProfile()" class="profile-btn btn-outline-custom">
          ‚úèÔ∏è Edit Profile
        </button>
        <button onclick="showChangePassword()" class="profile-btn btn-outline-custom">
          üîí Change Password
        </button>
      </div>
      <div class="profile-section">
        <button onclick="logout()" class="profile-btn btn-danger-custom">
          üö™ Logout
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Main Content -->
<div class="main-content">
  <div class="page-header">
    <h1>üîç Discover Skills</h1>
    <p>Find the perfect mentor and start learning today</p>
  </div>

  <div class="search-card">
    <!-- Search Bar -->
    <div class="search-input-wrapper">
      <input type="text"
             id="searchInput"
             class="search-input"
             placeholder="üîé Search for any skill... (e.g., Python, Guitar)"
             onkeypress="handleSearchEnter(event)">
      <button class="search-btn" onclick="performSearch()">
        Search
      </button>
    </div>

    <!-- Popular Searches -->
    <div class="popular-section">
      <h4 class="mb-3">üî• Popular Searches</h4>
      <div class="popular-tags">
        <span class="popular-tag" onclick="quickSearch('Python')">Python</span>
        <span class="popular-tag" onclick="quickSearch('Web Design')">Web Design</span>
        <span class="popular-tag" onclick="quickSearch('Guitar')">Guitar</span>
        <span class="popular-tag" onclick="quickSearch('Marketing')">Marketing</span>
        <span class="popular-tag" onclick="quickSearch('Data Science')">Data Science</span>
      </div>
    </div>

    <!-- Categories Grid -->
    <div class="mb-4">
      <h4 class="mb-3">üìÇ Browse by Category</h4>
      <div class="categories-grid">
        <div class="category-card" onclick="filterByCategory('Programming')">
          <div class="category-icon">üíª</div>
          <div>Programming</div>
        </div>
        <div class="category-card" onclick="filterByCategory('Design')">
          <div class="category-icon">üé®</div>
          <div>Design</div>
        </div>
        <div class="category-card" onclick="filterByCategory('Business')">
          <div class="category-icon">üíº</div>
          <div>Business</div>
        </div>
        <div class="category-card" onclick="filterByCategory('Data Science')">
          <div class="category-icon">üìä</div>
          <div>Data Science</div>
        </div>
      </div>
    </div>

    <!-- Tabs -->
    <div class="tabs-nav">
      <button class="tab-btn active" onclick="showTab('search')">
        üîç Search Results
      </button>
      <button class="tab-btn" onclick="showTab('trending')">
        üî• Trending
      </button>
      <button class="tab-btn" onclick="showTab('recent')">
        üÜï Recent
      </button>
    </div>

    <!-- Results -->
    <div id="searchTab" class="tab-content">
      <div id="skillsContainer" class="skills-grid">
        <div class="text-center py-5">
          <div class="spinner-border" role="status"></div>
          <p class="mt-3">Loading skills...</p>
        </div>
      </div>
    </div>
    <div id="trendingTab" class="tab-content" style="display:none;">
      <div id="trendingContainer" class="skills-grid"></div>
    </div>
    <div id="recentTab" class="tab-content" style="display:none;">
      <div id="recentContainer" class="skills-grid"></div>
    </div>
  </div>
</div>

<!-- Edit Profile Modal -->
<div id="editProfileModal" class="modal-overlay">
  <div class="modal-content">
    <div class="modal-header">
      <h4>‚úèÔ∏è Edit Profile</h4>
      <button class="close-btn" onclick="closeEditProfile()">&times;</button>
    </div>
    <form id="editProfileForm">
      <div class="form-group">
        <label class="form-label">Full Name</label>
        <input type="text" id="editFullName" class="form-control" required>
      </div>
      <div class="form-group" id="qualificationGroup" style="display:none;">
        <label class="form-label">Qualification</label>
        <input type="text" id="editQualification" class="form-control">
      </div>
      <div class="form-group" id="experienceGroup" style="display:none;">
        <label class="form-label">Experience (years)</label>
        <input type="number" id="editExperience" class="form-control">
      </div>
      <div class="form-group" id="institutionGroup" style="display:none;">
        <label class="form-label">Institution</label>
        <input type="text" id="editInstitution" class="form-control">
      </div>
      <div class="form-group">
        <label class="form-label">Age</label>
        <input type="number" id="editAge" class="form-control">
      </div>
      <div class="d-flex gap-2">
        <button type="submit" class="btn btn-primary flex-grow-1">
          üíæ Save Changes
        </button>
        <button type="button" onclick="closeEditProfile()" class="btn btn-secondary">
          Cancel
        </button>
      </div>
    </form>
  </div>
</div>

<!-- Change Password Modal -->
<div id="changePasswordModal" class="modal-overlay">
  <div class="modal-content">
    <div class="modal-header">
      <h4>üîí Change Password</h4>
      <button class="close-btn" onclick="closeChangePassword()">&times;</button>
    </div>
    <form id="changePasswordForm">
      <div class="form-group">
        <label class="form-label">Current Password</label>
        <input type="password" id="currentPassword" class="form-control" required>
      </div>
      <div class="form-group">
        <label class="form-label">New Password</label>
        <input type="password" id="newPassword" class="form-control" required minlength="6">
      </div>
      <div class="form-group">
        <label class="form-label">Confirm New Password</label>
        <input type="password" id="confirmNewPassword" class="form-control" required minlength="6">
      </div>
      <div class="d-flex gap-2">
        <button type="submit" class="btn btn-primary flex-grow-1">
          üîí Change Password
        </button>
        <button type="button" onclick="closeChangePassword()" class="btn btn-secondary">
          Cancel
        </button>
      </div>
    </form>
  </div>
</div>

<script>
const API_BASE = "http://localhost:8000";
const token = localStorage.getItem("token");
const role = localStorage.getItem("role");
let allSkills = []; // Global storage for filtering

if (!token) {
  alert("Please login first!");
  window.location.href = "/static/login.html";
}

// Toggle sliding sidebar
function toggleProfileSidebar() {
  const sidebar = document.getElementById("profileSidebar");
  const overlay = document.getElementById("sidebarOverlay");
  sidebar.classList.toggle("open");
  overlay.classList.toggle("show");
}
function closeProfileSidebar() {
  document.getElementById("profileSidebar").classList.remove("open");
  document.getElementById("sidebarOverlay").classList.remove("show");
}

// Load profile
async function loadProfile() {
  try {
    const response = await fetch(`${API_BASE}/users/me`, {
      headers: { "Authorization": `Bearer ${token}` }
    });
    if (!response.ok) throw new Error("Failed to load profile");
    const profile = await response.json();

    // ‚úÖ Use full_name from profile, fallback to email prefix if missing
    const fullName = profile.full_name?.trim() || 
                    (profile.email ? profile.email.split('@')[0] : "User");
    
    document.getElementById("navName").textContent = fullName;
    document.getElementById("profileName").textContent = fullName;

    if (role === "mentor") {
      document.getElementById("navAvatar").textContent = "üë®‚Äçüè´";
      document.getElementById("profileAvatar").textContent = "üë®‚Äçüè´";
      document.getElementById("profileRole").textContent = "üë®‚Äçüè´ Mentor";
      document.getElementById("mentorProfile").style.display = "block";
      document.getElementById("learnerProfile").style.display = "none";

      document.getElementById("mentorEmail").textContent = profile.email || "-";
      document.getElementById("mentorQualification").textContent = profile.qualification || "Not specified";
      document.getElementById("mentorExperience").textContent = (profile.experience || "0") + " years";
      document.getElementById("mentorAge").textContent = profile.age || "Not specified";

    } else if (role === "learner") {
      document.getElementById("navAvatar").textContent = "üë§";
      document.getElementById("profileAvatar").textContent = "üë§";
      document.getElementById("profileRole").textContent = "üë§ Learner";
      document.getElementById("learnerProfile").style.display = "block";
      document.getElementById("mentorProfile").style.display = "none";

      document.getElementById("learnerFullName").textContent = fullName;
      document.getElementById("learnerEmail").textContent = profile.email || "-";
      document.getElementById("learnerInstitution").textContent = profile.studying || "Not specified";
      document.getElementById("learnerAge").textContent = profile.age || "Not specified";

    } else {
      // Fallback for unknown roles
      document.getElementById("navAvatar").textContent = "üë§";
      document.getElementById("profileAvatar").textContent = "üë§";
      document.getElementById("profileRole").textContent = "User";
    }

  } catch (error) {
    console.error("Error loading profile:", error);
    // Keep default values but log error
    document.getElementById("navName").textContent = "User";
    document.getElementById("profileName").textContent = "User";
  }
}

// Load skills from backend
async function loadSkills() {
  try {
    const res = await fetch(`${API_BASE}/search/skills`, {
      headers: { "Authorization": `Bearer ${token}` }
    });
    
    if (!res.ok) throw new Error(`HTTP ${res.status}`);
    const skills = await res.json();
    
    allSkills = skills; // Store for filtering
    displaySkills(skills);
  } catch (err) {
    console.error("Failed to load skills:", err);
    document.getElementById("skillsContainer").innerHTML = 
      `<div class="alert alert-warning text-center py-4">
        <i class="fas fa-exclamation-triangle me-2"></i>
        No skills available. Add some via <a href="/static/add-skill.html" class="fw-bold">Add Skill</a>.
      </div>`;
  }
}

// Display skills
function displaySkills(skills) {
  const container = document.getElementById("skillsContainer");
  
  if (skills.length === 0) {
    container.innerHTML = '<p class="text-center py-5">No skills found</p>';
    return;
  }
  
  container.innerHTML = skills.map(skill => `
    <div class="skill-card">
      <div class="d-flex justify-content-between align-items-start mb-3">
        <h5 class="skill-title">${skill.name}</h5>
        <span class="mentor-count">${skill.mentor_count} üë®‚Äçüè´</span>
      </div>
      <p class="text-muted">${skill.description || ''}</p>
      <button class="view-mentors-btn" 
              onclick="viewMentors(${skill.id}, '${skill.name.replace(/'/g, "\\'")}');">
        View Mentors ‚Üí
      </button>
    </div>
  `).join('');
}

// Navigate to mentors page
function viewMentors(skillId, skillName) {
  // ‚úÖ Critical: Pass skillId as number, skillName as string
  window.location.href = `/static/mentors.html?skill=${encodeURIComponent(skillId)}&name=${encodeURIComponent(skillName)}`;
}

// Search functionality
function performSearch() {
  const query = document.getElementById("searchInput").value.toLowerCase().trim();
  if (!query) {
    displaySkills(allSkills);
    return;
  }
  
  const filtered = allSkills.filter(skill => 
    skill.name.toLowerCase().includes(query)
  );
  displaySkills(filtered);
}

function handleSearchEnter(e) { 
  if (e.key === "Enter") performSearch(); 
}

function quickSearch(q) { 
  document.getElementById("searchInput").value = q; 
  performSearch(); 
}

function filterByCategory(cat) {
  const filtered = allSkills.filter(skill => 
    skill.category.toLowerCase() === cat.toLowerCase()
  );
  displaySkills(filtered);
}

function showTab(tab) {
  document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
  event.target.classList.add('active');
  ['searchTab', 'trendingTab', 'recentTab'].forEach(id => {
    document.getElementById(id).style.display = 'none';
  });
  document.getElementById(`${tab}Tab`).style.display = 'block';
  
  // Load tab-specific data
  if (tab === 'trending') {
    const trending = [...allSkills].sort((a, b) => (b.mentor_count || 0) - (a.mentor_count || 0)).slice(0, 12);
    document.getElementById('trendingContainer').innerHTML = trending.map(renderSkillCard).join('');
  } else if (tab === 'recent') {
    // Requires created_at in skills - fallback to allSkills
    document.getElementById('recentContainer').innerHTML = allSkills.slice(0, 12).map(renderSkillCard).join('');
  }
}

function renderSkillCard(skill) {
  return `
    <div class="skill-card">
      <div class="d-flex justify-content-between align-items-start mb-3">
        <h5 class="skill-title">${skill.name}</h5>
        <span class="mentor-count">${skill.mentor_count} üë®‚Äçüè´</span>
      </div>
      <p class="text-muted">${skill.description || ''}</p>
      <button class="view-mentors-btn" 
              onclick="viewMentors(${skill.id}, '${skill.name.replace(/'/g, "\\'")}');">
        View Mentors ‚Üí
      </button>
    </div>
  `;
}

// Profile modals
function showEditProfile() {
  if (role === "mentor") {
    document.getElementById("qualificationGroup").style.display = "block";
    document.getElementById("experienceGroup").style.display = "block";
    document.getElementById("institutionGroup").style.display = "none";
  } else {
    document.getElementById("qualificationGroup").style.display = "none";
    document.getElementById("experienceGroup").style.display = "none";
    document.getElementById("institutionGroup").style.display = "block";
  }
  document.getElementById("editProfileModal").classList.add("show");
}
function closeEditProfile() {
  document.getElementById("editProfileModal").classList.remove("show");
}

document.getElementById("editProfileForm").addEventListener("submit", async (e) => {
  e.preventDefault();
  const data = {
    full_name: document.getElementById("editFullName").value,
    age: parseInt(document.getElementById("editAge").value) || undefined
  };
  if (role === "mentor") {
    data.qualification = document.getElementById("editQualification").value;
    data.experience = parseInt(document.getElementById("editExperience").value) || undefined;
  } else {
    data.studying = document.getElementById("editInstitution").value;
  }
  
  // TODO: Integrate with PUT /users/profile
  alert("Profile update logic ready ‚Äî integrate with backend");
  closeEditProfile();
});

function showChangePassword() {
  document.getElementById("changePasswordModal").classList.add("show");
}
function closeChangePassword() {
  document.getElementById("changePasswordModal").classList.remove("show");
}
document.getElementById("changePasswordForm").addEventListener("submit", (e) => {
  e.preventDefault();
  // TODO: Integrate with POST /users/change-password
  alert("Password change logic ready ‚Äî integrate with backend");
  closeChangePassword();
});

function logout() {
  localStorage.clear();
  window.location.href = "/static/login.html";
}

// Initialize
window.onload = async () => {
  await loadProfile();
  await loadSkills();
};
</script>
</body>
</html>